/*! Made on 07-07-2016 */
var app=angular.module("myApp",["ui.router"]);app.config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(a,b,c,d){d.interceptors.push("authInterceptor"),a.state("home",{url:"/home",templateUrl:"library/components/navigation/navMain.html",controller:"AuthCtrl",onEnter:["$state","auth",function(a,b){!b.isLoggedIn()}]}).state("test",{url:"/views",templateUrl:"views/error.html",controller:"AuthCtrl"}),b.otherwise("home")}]),app.controller("AuthCtrl",["$scope","$state","auth","$stateParams","$location","$timeout",function(a,b,c,d,e,f){}]),app.factory("auth",["$http","$window","$location",function(a,b,c){var d={};return d.saveToken=function(a){b.localStorage.appToken=a},d.getToken=function(){return b.localStorage.appToken},d.isLoggedIn=function(){var a=d.getToken();if(a){var c=JSON.parse(b.atob(a.split(".")[1]));return c.exp>Date.now()/1e3}return!1},d.isAdmin=function(){for(var a=d.getToken(),c=JSON.parse(b.atob(a.split(".")[1])),e=c.scopes,f=0;f<e.length;f++)if("admin"===e[f])return!0;return!1},d.isMod=function(){for(var a=d.getToken(),c=JSON.parse(b.atob(a.split(".")[1])),e=c.scopes,f=0;f<e.length;f++)if("moderator"===e[f]||"admin"===e[f])return!0;return!1},d.isWriter=function(){for(var a=d.getToken(),c=JSON.parse(b.atob(a.split(".")[1])),e=c.scopes,f=0;f<e.length;f++)if("moderator"===e[f]||"admin"===e[f]||"writer"===e[f])return!0;return!1},d.currentUser=function(){if(d.isLoggedIn()){var a=d.getToken(),c=JSON.parse(b.atob(a.split(".")[1]));return c.username}},d.currentUserId=function(){if(d.isLoggedIn()){var a=d.getToken(),c=JSON.parse(b.atob(a.split(".")[1]));return c.id}},d.currentName=function(){var a=d.getToken(),c=JSON.parse(b.atob(a.split(".")[1]));return c.name},d.imageurl=function(){if(d.isLoggedIn()){var a=d.getToken(),c=JSON.parse(b.atob(a.split(".")[1]));return c.imageurl}},d.register=function(b){a.post("/register",b).success(function(a){})},d.logIn=function(b){return a.post("/login",b).success(function(a){d.saveToken(a.token)})},d.logOut=function(){b.localStorage.removeItem("appToken"),c.path("/login")},d.resetPassword=function(b){var c;return a.post("/forgotPassword",{email:b}).success(function(a){angular.copy(a,c)}),c},d.newPassword=function(b){var c;return a.post("/reset/"+b.token,b).success(function(a){angular.copy(a,c)}),c},d}]),app.factory("authInterceptor",function(a,b,c){return{request:function(a){return a.headers=a.headers||{},c.localStorage.appToken&&(a.headers.Authorization="Bearer "+c.localStorage.appToken),a},response:function(a){return 401===a.status,a||b.when(a)}}}),app.controller("NavCtrl",["$scope","auth",function(a,b){}]);